version: "3.9"
name: "otus-project"

services:
  postgres:
    image: "postgres:15.2-alpine"
    container_name: "otus-project-postgres"
    volumes:
      - postgres_data:/var/lib/postgresql/data/
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=project

  project:
    build:
      context: ..
      dockerfile: build/Dockerfile
    container_name: "otus-project"
    depends_on:
      - postgres
    environment:
      - DATABASE_DSN=postgres://user:password@postgres:5432/project?sslmode=disable

  nginx:
    image: "nginx:1.23.4-alpine"
    container_name: "otus-project-nginx"
    ports:
      - "8080:80"
    volumes:
      - ./resources/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - project

volumes:
  postgres_data:
